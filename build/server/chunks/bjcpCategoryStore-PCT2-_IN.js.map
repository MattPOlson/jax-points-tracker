{"version":3,"file":"bjcpCategoryStore-PCT2-_IN.js","sources":["../../../.svelte-kit/adapter-node/chunks/bjcpCategoryStore.js"],"sourcesContent":["import { d as derived, w as writable } from \"./index.js\";\nimport { s as supabase } from \"./supabaseClient.js\";\nimport { j as get_store_value } from \"./ssr.js\";\nconst bjcpCategories = writable([]);\nconst competitions = writable([]);\nconst isLoaded = writable(false);\nconst isLoading = writable(false);\nconst error = writable(null);\nconst lastRefresh = writable(null);\nconst categoriesByNumber = derived(bjcpCategories, ($bjcpCategories) => {\n  const grouped = {};\n  $bjcpCategories.forEach((cat) => {\n    if (!grouped[cat.category_number]) {\n      grouped[cat.category_number] = {\n        number: cat.category_number,\n        name: cat.category_name,\n        subcategories: []\n      };\n    }\n    if (cat.subcategory_letter) {\n      grouped[cat.category_number].subcategories.push({\n        id: cat.id,\n        letter: cat.subcategory_letter,\n        name: cat.subcategory_name,\n        full_name: cat.subcategory_name,\n        // Updated to use subcategory_name\n        description: cat.description\n      });\n    }\n  });\n  return grouped;\n});\nconst mainCategories = derived(categoriesByNumber, ($categoriesByNumber) => {\n  return Object.values($categoriesByNumber).sort(\n    (a, b) => parseInt(a.number) - parseInt(b.number)\n  );\n});\nconst activeCompetitions = derived(competitions, ($competitions) => {\n  const now = /* @__PURE__ */ new Date();\n  return $competitions.filter((comp) => comp.active && new Date(comp.entry_deadline) > now).sort((a, b) => new Date(a.entry_deadline) - new Date(b.entry_deadline));\n});\nderived(competitions, ($competitions) => {\n  return $competitions.sort((a, b) => {\n    const parseTimestamp = (timestamp) => {\n      if (!timestamp) return /* @__PURE__ */ new Date(0);\n      try {\n        let isoString = timestamp;\n        if (timestamp.includes(\" \") && !timestamp.includes(\"T\")) {\n          isoString = timestamp.replace(\" \", \"T\");\n          if (!isoString.includes(\"+\") && !isoString.includes(\"Z\")) {\n            isoString += \"Z\";\n          }\n        }\n        return new Date(isoString);\n      } catch {\n        return /* @__PURE__ */ new Date(0);\n      }\n    };\n    return parseTimestamp(b.created_at) - parseTimestamp(a.created_at);\n  });\n});\nasync function loadBjcpCategories(forceRefresh = false) {\n  const now = /* @__PURE__ */ new Date();\n  const lastRefreshTime = get_store_value(lastRefresh);\n  if (!forceRefresh && lastRefreshTime && now - lastRefreshTime < 3e4) {\n    console.log(\"üéØ Using cached BJCP categories\");\n    return;\n  }\n  isLoading.set(true);\n  error.set(null);\n  try {\n    console.log(\"üìã Loading BJCP categories...\");\n    const { data, error: queryError } = await supabase.from(\"bjcp_categories\").select(\"*\").order(\"category_number\", { ascending: true }).order(\"subcategory_letter\", { ascending: true });\n    if (queryError) {\n      console.error(\"‚ùå Error loading BJCP categories:\", queryError);\n      throw queryError;\n    }\n    console.log(`‚úÖ Loaded ${data?.length || 0} BJCP categories`);\n    bjcpCategories.set(data || []);\n    lastRefresh.set(now);\n  } catch (err) {\n    console.error(\"üí• Failed to load BJCP categories:\", err);\n    error.set(err.message || \"Failed to load BJCP categories\");\n  } finally {\n    isLoading.set(false);\n    isLoaded.set(true);\n  }\n}\nasync function loadCompetitions(forceRefresh = false) {\n  const now = /* @__PURE__ */ new Date();\n  const lastRefreshTime = get_store_value(lastRefresh);\n  if (!forceRefresh && lastRefreshTime && now - lastRefreshTime < 3e4) {\n    console.log(\"üèÜ Using cached competitions\");\n    return;\n  }\n  isLoading.set(true);\n  error.set(null);\n  try {\n    console.log(\"üèÜ Loading competitions...\");\n    const { data, error: queryError } = await supabase.from(\"competitions\").select(\"*\").order(\"entry_deadline\", { ascending: false });\n    if (queryError) {\n      console.error(\"‚ùå Error loading competitions:\", queryError);\n      throw queryError;\n    }\n    console.log(`‚úÖ Loaded ${data?.length || 0} competitions`);\n    competitions.set(data || []);\n    lastRefresh.set(now);\n  } catch (err) {\n    console.error(\"üí• Failed to load competitions:\", err);\n    error.set(err.message || \"Failed to load competitions\");\n  } finally {\n    isLoading.set(false);\n    isLoaded.set(true);\n  }\n}\nasync function loadCompetitionData(forceRefresh = false) {\n  console.log(\"üöÄ Loading all competition data...\");\n  try {\n    await Promise.all([\n      loadBjcpCategories(forceRefresh),\n      loadCompetitions(forceRefresh)\n    ]);\n    console.log(\"‚úÖ All competition data loaded successfully\");\n  } catch (err) {\n    console.error(\"üí• Failed to load competition data:\", err);\n    throw err;\n  }\n}\nfunction getDaysUntilDeadline(competition) {\n  if (!competition) return null;\n  const now = /* @__PURE__ */ new Date();\n  const deadline = new Date(competition.entry_deadline);\n  const diffTime = deadline - now;\n  const diffDays = Math.ceil(diffTime / (1e3 * 60 * 60 * 24));\n  return diffDays > 0 ? diffDays : 0;\n}\nfunction formatDeadline(competition) {\n  if (!competition) return \"\";\n  const deadline = new Date(competition.entry_deadline);\n  const options = {\n    weekday: \"long\",\n    year: \"numeric\",\n    month: \"long\",\n    day: \"numeric\",\n    hour: \"numeric\",\n    minute: \"2-digit\"\n  };\n  return deadline.toLocaleDateString(\"en-US\", options);\n}\nif (typeof window !== \"undefined\") {\n  bjcpCategories.subscribe((value) => {\n    console.log(\"üìã BJCP Categories updated:\", value.length, \"categories\");\n  });\n  competitions.subscribe((value) => {\n    console.log(\"üèÜ Competitions updated:\", value.length, \"competitions\");\n  });\n  error.subscribe((value) => {\n    if (value) {\n      console.error(\"‚ùå Competition store error:\", value);\n    }\n  });\n}\nexport {\n  activeCompetitions as a,\n  isLoaded as b,\n  categoriesByNumber as c,\n  competitions as d,\n  error as e,\n  formatDeadline as f,\n  getDaysUntilDeadline as g,\n  bjcpCategories as h,\n  isLoading as i,\n  loadCompetitionData as l,\n  mainCategories as m\n};\n"],"names":[],"mappings":"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"}