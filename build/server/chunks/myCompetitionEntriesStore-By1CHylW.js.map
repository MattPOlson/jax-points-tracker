{"version":3,"file":"myCompetitionEntriesStore-By1CHylW.js","sources":["../../../.svelte-kit/adapter-node/chunks/myCompetitionEntriesStore.js"],"sourcesContent":["import { d as derived, w as writable } from \"./index.js\";\nimport { s as supabase } from \"./supabaseClient.js\";\nimport { u as userProfile } from \"./userProfile.js\";\nimport { j as get_store_value } from \"./ssr.js\";\nconst myEntries = writable([]);\nconst isLoaded = writable(false);\nconst isLoading = writable(false);\nconst error = writable(null);\nconst lastRefresh = writable(null);\nderived(myEntries, ($myEntries) => {\n  const grouped = {};\n  $myEntries.forEach((entry) => {\n    const compId = entry.competition.id;\n    if (!grouped[compId]) {\n      grouped[compId] = {\n        competition: entry.competition,\n        entries: []\n      };\n    }\n    grouped[compId].entries.push(entry);\n  });\n  return Object.values(grouped).sort(\n    (a, b) => new Date(b.competition.entry_deadline) - new Date(a.competition.entry_deadline)\n  );\n});\nderived(myEntries, ($myEntries) => {\n  const now = /* @__PURE__ */ new Date();\n  return $myEntries.filter(\n    (entry) => entry.competition.active && new Date(entry.competition.entry_deadline) > now\n  );\n});\nderived(myEntries, ($myEntries) => {\n  const now = /* @__PURE__ */ new Date();\n  return $myEntries.filter(\n    (entry) => !entry.competition.active || new Date(entry.competition.entry_deadline) <= now\n  );\n});\nconst entryStats = derived(myEntries, ($myEntries) => {\n  const stats = {\n    total: $myEntries.length,\n    active: 0,\n    past: 0,\n    pending_payment: 0,\n    paid: 0\n  };\n  const now = /* @__PURE__ */ new Date();\n  $myEntries.forEach((entry) => {\n    if (entry.competition.active && new Date(entry.competition.entry_deadline) > now) {\n      stats.active++;\n    } else {\n      stats.past++;\n    }\n    if (entry.entry_fee_paid) {\n      stats.paid++;\n    } else {\n      stats.pending_payment++;\n    }\n  });\n  return stats;\n});\nasync function loadMyEntries(forceRefresh = false) {\n  const now = /* @__PURE__ */ new Date();\n  const lastRefreshTime = get_store_value(lastRefresh);\n  let attempts = 0;\n  let userProfileValue = get_store_value(userProfile);\n  while (!userProfileValue?.id && attempts < 10) {\n    console.log(`‚è≥ Waiting for user profile... (attempt ${attempts + 1})`);\n    await new Promise((resolve) => setTimeout(resolve, 100));\n    userProfileValue = get_store_value(userProfile);\n    attempts++;\n  }\n  if (!userProfileValue?.id) {\n    console.log(\"‚ùå No user ID available after waiting - user may not be logged in\");\n    error.set(\"User not logged in\");\n    isLoaded.set(true);\n    return;\n  }\n  const userId = userProfileValue.id;\n  if (!forceRefresh && lastRefreshTime && now - lastRefreshTime < 3e4) {\n    console.log(\"üç∫ Using cached competition entries\");\n    return;\n  }\n  isLoading.set(true);\n  error.set(null);\n  try {\n    console.log(\"üç∫ Loading my competition entries...\");\n    const { data, error: queryError } = await supabase.from(\"competition_entries\").select(`\n                *,\n                competition:competitions(\n                    id,\n                    name,\n                    description,\n                    entry_deadline,\n                    judging_date,\n                    results_published,\n                    active\n                ),\n                bjcp_category:bjcp_categories(\n                    id,\n                    category_number,\n                    subcategory_letter,\n                    subcategory_name,\n                    category_name\n                ),\n                results:competition_results(\n                    score,\n                    placement,\n                    judge_notes\n                )\n            `).eq(\"member_id\", userId).order(\"submitted_at\", { ascending: false });\n    if (queryError) {\n      console.error(\"‚ùå Error loading entries:\", queryError);\n      throw queryError;\n    }\n    const processedEntries = (data || []).map((entry) => ({\n      ...entry,\n      // Add computed fields\n      category_display: entry.bjcp_category ? `${entry.bjcp_category.category_number}${entry.bjcp_category.subcategory_letter} - ${entry.bjcp_category.subcategory_name}` : \"Unknown Category\",\n      can_edit: entry.competition.active && new Date(entry.competition.entry_deadline) > now,\n      days_until_deadline: entry.competition.active ? Math.ceil((new Date(entry.competition.entry_deadline) - now) / (1e3 * 60 * 60 * 24)) : 0,\n      has_results: entry.results && entry.results.length > 0,\n      result: entry.results?.[0] || null\n    }));\n    console.log(`‚úÖ Loaded ${processedEntries.length} competition entries`);\n    myEntries.set(processedEntries);\n    lastRefresh.set(now);\n  } catch (err) {\n    console.error(\"üí• Failed to load competition entries:\", err);\n    error.set(err.message || \"Failed to load competition entries\");\n  } finally {\n    isLoading.set(false);\n    isLoaded.set(true);\n  }\n}\nfunction canEditEntry(entry) {\n  if (!entry) return false;\n  const now = /* @__PURE__ */ new Date();\n  return entry.competition.active && new Date(entry.competition.entry_deadline) > now;\n}\nfunction formatDeadline(entry) {\n  if (!entry?.competition?.entry_deadline) return \"\";\n  const deadline = new Date(entry.competition.entry_deadline);\n  const options = {\n    weekday: \"short\",\n    month: \"short\",\n    day: \"numeric\",\n    hour: \"numeric\",\n    minute: \"2-digit\"\n  };\n  return deadline.toLocaleDateString(\"en-US\", options);\n}\nfunction getAwardDisplay(result) {\n  if (!result) return null;\n  switch (result.placement) {\n    case \"1\":\n      return \"ü•á 1st Place\";\n    case \"2\":\n      return \"ü•à 2nd Place\";\n    case \"3\":\n      return \"ü•â 3rd Place\";\n    case \"HM\":\n      return \"üèÖ Honorable Mention\";\n    default:\n      return result.score ? `Score: ${result.score}/50` : \"No Results\";\n  }\n}\nfunction getPaymentStatus(entry) {\n  return entry.entry_fee_paid ? { text: \"‚úÖ Paid\", class: \"paid\" } : { text: \"‚è≥ Pending\", class: \"pending\" };\n}\nif (typeof window !== \"undefined\") {\n  myEntries.subscribe((value) => {\n    console.log(\"üç∫ My entries updated:\", value.length, \"entries\");\n  });\n  error.subscribe((value) => {\n    if (value) {\n      console.error(\"‚ùå My entries store error:\", value);\n    }\n  });\n}\nexport {\n  isLoading as a,\n  error as b,\n  getAwardDisplay as c,\n  canEditEntry as d,\n  entryStats as e,\n  formatDeadline as f,\n  getPaymentStatus as g,\n  isLoaded as i,\n  loadMyEntries as l,\n  myEntries as m\n};\n"],"names":[],"mappings":"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"}