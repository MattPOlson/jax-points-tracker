{"version":3,"file":"leaderboardStore-6wvoJyX-.js","sources":["../../../.svelte-kit/adapter-node/chunks/leaderboardStore.js"],"sourcesContent":["import { w as writable } from \"./index.js\";\nimport { s as supabase } from \"./supabaseClient.js\";\nconst leaderboard = writable([]);\nconst message = writable(\"\");\nconst loading = writable(false);\nlet lastLoaded = 0;\nconst CACHE_MS = 1e4;\nasync function loadLeaderboard(force = false) {\n  if (!force && Date.now() - lastLoaded < CACHE_MS) return;\n  loading.set(true);\n  const { data, error } = await supabase.from(\"point_submissions\").select(`\n      points,\n      approved,\n      member_id,\n      members(id, name)\n    `).eq(\"approved\", true);\n  lastLoaded = Date.now();\n  if (error) {\n    console.error(\"Error loading leaderboard:\", error);\n    message.set(\"Failed to load leaderboard.\");\n    leaderboard.set([]);\n    loading.set(false);\n    return;\n  }\n  const totals = /* @__PURE__ */ new Map();\n  for (const entry of data) {\n    const id = entry.members?.id;\n    const name = entry.members?.name;\n    const points = entry.points || 0;\n    if (!id || !name) continue;\n    if (!totals.has(id)) totals.set(id, { name, points: 0 });\n    totals.get(id).points += points;\n  }\n  leaderboard.set(\n    Array.from(totals.values()).sort((a, b) => b.points - a.points).slice(0, 10)\n  );\n  message.set(\"\");\n  loading.set(false);\n}\nexport {\n  loading as a,\n  leaderboard as b,\n  loadLeaderboard as l,\n  message as m\n};\n"],"names":[],"mappings":";;;AAEK,MAAC,WAAW,GAAG,QAAQ,CAAC,EAAE;AAC1B,MAAC,OAAO,GAAG,QAAQ,CAAC,EAAE;AACtB,MAAC,OAAO,GAAG,QAAQ,CAAC,KAAK;AAC9B,IAAI,UAAU,GAAG,CAAC;AAClB,MAAM,QAAQ,GAAG,GAAG;AACpB,eAAe,eAAe,CAAC,KAAK,GAAG,KAAK,EAAE;AAC9C,EAAE,IAAI,CAAC,KAAK,IAAI,IAAI,CAAC,GAAG,EAAE,GAAG,UAAU,GAAG,QAAQ,EAAE;AACpD,EAAE,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC;AACnB,EAAE,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,QAAQ,CAAC,IAAI,CAAC,mBAAmB,CAAC,CAAC,MAAM,CAAC;AAC1E;AACA;AACA;AACA;AACA,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,UAAU,EAAE,IAAI,CAAC;AAC3B,EAAE,UAAU,GAAG,IAAI,CAAC,GAAG,EAAE;AACzB,EAAE,IAAI,KAAK,EAAE;AACb,IAAI,OAAO,CAAC,KAAK,CAAC,4BAA4B,EAAE,KAAK,CAAC;AACtD,IAAI,OAAO,CAAC,GAAG,CAAC,6BAA6B,CAAC;AAC9C,IAAI,WAAW,CAAC,GAAG,CAAC,EAAE,CAAC;AACvB,IAAI,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC;AACtB,IAAI;AACJ;AACA,EAAE,MAAM,MAAM,mBAAmB,IAAI,GAAG,EAAE;AAC1C,EAAE,KAAK,MAAM,KAAK,IAAI,IAAI,EAAE;AAC5B,IAAI,MAAM,EAAE,GAAG,KAAK,CAAC,OAAO,EAAE,EAAE;AAChC,IAAI,MAAM,IAAI,GAAG,KAAK,CAAC,OAAO,EAAE,IAAI;AACpC,IAAI,MAAM,MAAM,GAAG,KAAK,CAAC,MAAM,IAAI,CAAC;AACpC,IAAI,IAAI,CAAC,EAAE,IAAI,CAAC,IAAI,EAAE;AACtB,IAAI,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,EAAE,CAAC,EAAE,MAAM,CAAC,GAAG,CAAC,EAAE,EAAE,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC,EAAE,CAAC;AAC5D,IAAI,MAAM,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC,MAAM,IAAI,MAAM;AACnC;AACA,EAAE,WAAW,CAAC,GAAG;AACjB,IAAI,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,MAAM,EAAE,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC,MAAM,GAAG,CAAC,CAAC,MAAM,CAAC,CAAC,KAAK,CAAC,CAAC,EAAE,EAAE;AAC/E,GAAG;AACH,EAAE,OAAO,CAAC,GAAG,CAAC,EAAE,CAAC;AACjB,EAAE,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC;AACpB;;;;"}