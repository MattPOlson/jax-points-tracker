import{s as Je,n as fe,d as k,q as b,i as B,b as l,c as j,e as V,E as O,g as S,f as G,h as C,j as R,t as M,k as _e,C as Ae,a as K,w as le,F as pe,G as Ce,M as he,r as Be}from"../chunks/Clc9C5PT.js";import{e as ne}from"../chunks/CERxzA5o.js";import{S as Ue,i as Oe}from"../chunks/D83E1sq8.js";import{g as Ye}from"../chunks/CR8AP7EE.js";import{p as Pe}from"../chunks/CTkKsmfM.js";import{u as Fe}from"../chunks/BZKsMI7B.js";import{a as We,i as Ke,c as Qe}from"../chunks/C1YXK-ZI.js";import{s as W}from"../chunks/CCM_4jRA.js";function qe(n,e,t){const r=n.slice();return r[30]=e[t],r[32]=t,r}function Ee(n,e,t){const r=n.slice();return r[8]=e[t],r}function we(n,e,t){const r=n.slice();return r[35]=e[t],r}function Xe(n){let e,t,r,s=n[1].length+"",o,i,_,c,f,a,q=ne(n[1]),d=[];for(let g=0;g<q.length;g+=1)d[g]=ze(we(n,q,g));let y=n[2]&&De(n);return{c(){e=C("div"),t=C("h2"),r=M("Select Category to Rank ("),o=M(s),i=M(" categories)"),_=R(),c=C("div");for(let g=0;g<d.length;g+=1)d[g].c();f=R(),y&&y.c(),a=Ce(),this.h()},l(g){e=j(g,"DIV",{class:!0});var m=V(e);t=j(m,"H2",{});var u=V(t);r=G(u,"Select Category to Rank ("),o=G(u,s),i=G(u," categories)"),u.forEach(k),_=S(m),c=j(m,"DIV",{class:!0});var p=V(c);for(let z=0;z<d.length;z+=1)d[z].l(p);p.forEach(k),m.forEach(k),f=S(g),y&&y.l(g),a=Ce(),this.h()},h(){b(c,"class","categories-grid svelte-zjv6iq"),b(e,"class","categories-section svelte-zjv6iq")},m(g,m){B(g,e,m),l(e,t),l(t,r),l(t,o),l(t,i),l(e,_),l(e,c);for(let u=0;u<d.length;u+=1)d[u]&&d[u].m(c,null);B(g,f,m),y&&y.m(g,m),B(g,a,m)},p(g,m){if(m[0]&2&&s!==(s=g[1].length+"")&&K(o,s),m[0]&1030){q=ne(g[1]);let u;for(u=0;u<q.length;u+=1){const p=we(g,q,u);d[u]?d[u].p(p,m):(d[u]=ze(p),d[u].c(),d[u].m(c,null))}for(;u<d.length;u+=1)d[u].d(1);d.length=q.length}g[2]?y?y.p(g,m):(y=De(g),y.c(),y.m(a.parentNode,a)):y&&(y.d(1),y=null)},d(g){g&&(k(e),k(f),k(a)),pe(d,g),y&&y.d(g)}}}function Ze(n){let e,t="<h3>No Categories Found</h3> <p>No entries have been submitted for this competition yet.</p>";return{c(){e=C("div"),e.innerHTML=t,this.h()},l(r){e=j(r,"DIV",{class:!0,"data-svelte-h":!0}),O(e)!=="svelte-1c7kpl1"&&(e.innerHTML=t),this.h()},h(){b(e,"class","empty-state svelte-zjv6iq")},m(r,s){B(r,e,s)},p:fe,d(r){r&&k(e)}}}function xe(n){let e,t,r="Error Loading Data",s,o,i,_,c,f="üîÑ Retry",a,q;return{c(){e=C("div"),t=C("h3"),t.textContent=r,s=R(),o=C("p"),i=M(n[8]),_=R(),c=C("button"),c.textContent=f,this.h()},l(d){e=j(d,"DIV",{class:!0});var y=V(e);t=j(y,"H3",{"data-svelte-h":!0}),O(t)!=="svelte-14daeti"&&(t.textContent=r),s=S(y),o=j(y,"P",{});var g=V(o);i=G(g,n[8]),g.forEach(k),_=S(y),c=j(y,"BUTTON",{class:!0,"data-svelte-h":!0}),O(c)!=="svelte-k0kltk"&&(c.textContent=f),y.forEach(k),this.h()},h(){b(c,"class","nav-btn nav-btn-primary svelte-zjv6iq"),b(e,"class","error-state svelte-zjv6iq")},m(d,y){B(d,e,y),l(e,t),l(e,s),l(e,o),l(o,i),l(e,_),l(e,c),a||(q=le(c,"click",n[18]),a=!0)},p(d,y){y[0]&256&&K(i,d[8])},d(d){d&&k(e),a=!1,q()}}}function $e(n){let e,t='<div class="spinner svelte-zjv6iq"></div> <p>Loading categories and rankings...</p>';return{c(){e=C("div"),e.innerHTML=t,this.h()},l(r){e=j(r,"DIV",{class:!0,"data-svelte-h":!0}),O(e)!=="svelte-gsq85"&&(e.innerHTML=t),this.h()},h(){b(e,"class","loading svelte-zjv6iq")},m(r,s){B(r,e,s)},p:fe,d(r){r&&k(e)}}}function ze(n){let e,t,r=n[35].displayName+"",s,o,i,_=n[35].entryCount+"",c,f,a,q,d,y;function g(){return n[19](n[35])}return{c(){e=C("div"),t=C("div"),s=M(r),o=R(),i=C("div"),c=M(_),f=M(" entries"),a=R(),this.h()},l(m){e=j(m,"DIV",{class:!0,role:!0,tabindex:!0});var u=V(e);t=j(u,"DIV",{class:!0});var p=V(t);s=G(p,r),p.forEach(k),o=S(u),i=j(u,"DIV",{class:!0});var z=V(i);c=G(z,_),f=G(z," entries"),z.forEach(k),a=S(u),u.forEach(k),this.h()},h(){var m;b(t,"class","category-name svelte-zjv6iq"),b(i,"class","category-stats svelte-zjv6iq"),b(e,"class",q="category-card "+(((m=n[2])==null?void 0:m.id)===n[35].id?"selected":"")+" svelte-zjv6iq"),b(e,"role","button"),b(e,"tabindex","0")},m(m,u){B(m,e,u),l(e,t),l(t,s),l(e,o),l(e,i),l(i,c),l(i,f),l(e,a),d||(y=le(e,"click",g),d=!0)},p(m,u){var p;n=m,u[0]&2&&r!==(r=n[35].displayName+"")&&K(s,r),u[0]&2&&_!==(_=n[35].entryCount+"")&&K(c,_),u[0]&6&&q!==(q="category-card "+(((p=n[2])==null?void 0:p.id)===n[35].id?"selected":"")+" svelte-zjv6iq")&&b(e,"class",q)},d(m){m&&k(e),d=!1,y()}}}function De(n){let e,t,r,s,o=n[2].displayName+"",i,_,c,f=n[4]?"Saving...":"Save Rankings",a,q,d,y,g,m,u,p=n[6].length>0&&Ie(n),z=n[5]==="intraclub"&&Ne();function Q(D,N){return D[0].length===0?tt:et}let X=Q(n),T=X(n);return{c(){e=C("div"),t=C("div"),r=C("h2"),s=M("Rankings for "),i=M(o),_=R(),c=C("button"),a=M(f),d=R(),p&&p.c(),y=R(),z&&z.c(),g=R(),T.c(),this.h()},l(D){e=j(D,"DIV",{class:!0});var N=V(e);t=j(N,"DIV",{class:!0});var Y=V(t);r=j(Y,"H2",{class:!0});var Z=V(r);s=G(Z,"Rankings for "),i=G(Z,o),Z.forEach(k),_=S(Y),c=j(Y,"BUTTON",{class:!0});var $=V(c);a=G($,f),$.forEach(k),Y.forEach(k),d=S(N),p&&p.l(N),y=S(N),z&&z.l(N),g=S(N),T.l(N),N.forEach(k),this.h()},h(){b(r,"class","svelte-zjv6iq"),b(c,"class","save-btn svelte-zjv6iq"),c.disabled=q=n[4]||n[0].length===0,b(t,"class","rankings-header svelte-zjv6iq"),b(e,"class","rankings-section svelte-zjv6iq")},m(D,N){B(D,e,N),l(e,t),l(t,r),l(r,s),l(r,i),l(t,_),l(t,c),l(c,a),l(e,d),p&&p.m(e,null),l(e,y),z&&z.m(e,null),l(e,g),T.m(e,null),m||(u=le(c,"click",n[13]),m=!0)},p(D,N){N[0]&4&&o!==(o=D[2].displayName+"")&&K(i,o),N[0]&16&&f!==(f=D[4]?"Saving...":"Save Rankings")&&K(a,f),N[0]&17&&q!==(q=D[4]||D[0].length===0)&&(c.disabled=q),D[6].length>0?p?p.p(D,N):(p=Ie(D),p.c(),p.m(e,y)):p&&(p.d(1),p=null),D[5]==="intraclub"?z||(z=Ne(),z.c(),z.m(e,g)):z&&(z.d(1),z=null),X===(X=Q(D))&&T?T.p(D,N):(T.d(1),T=X(D),T&&(T.c(),T.m(e,null)))},d(D){D&&k(e),p&&p.d(),z&&z.d(),T.d(),m=!1,u()}}}function Ie(n){let e,t,r="‚ö†Ô∏è Ranking Restrictions",s,o=ne(n[6]),i=[];for(let _=0;_<o.length;_+=1)i[_]=Ve(Ee(n,o,_));return{c(){e=C("div"),t=C("h4"),t.textContent=r,s=R();for(let _=0;_<i.length;_+=1)i[_].c();this.h()},l(_){e=j(_,"DIV",{class:!0});var c=V(e);t=j(c,"H4",{class:!0,"data-svelte-h":!0}),O(t)!=="svelte-8c14r8"&&(t.textContent=r),s=S(c);for(let f=0;f<i.length;f+=1)i[f].l(c);c.forEach(k),this.h()},h(){b(t,"class","svelte-zjv6iq"),b(e,"class","validation-warning svelte-zjv6iq")},m(_,c){B(_,e,c),l(e,t),l(e,s);for(let f=0;f<i.length;f+=1)i[f]&&i[f].m(e,null)},p(_,c){if(c[0]&64){o=ne(_[6]);let f;for(f=0;f<o.length;f+=1){const a=Ee(_,o,f);i[f]?i[f].p(a,c):(i[f]=Ve(a),i[f].c(),i[f].m(e,null))}for(;f<i.length;f+=1)i[f].d(1);i.length=o.length}},d(_){_&&k(e),pe(i,_)}}}function Ve(n){let e,t=n[8].message+"",r;return{c(){e=C("div"),r=M(t),this.h()},l(s){e=j(s,"DIV",{class:!0});var o=V(e);r=G(o,t),o.forEach(k),this.h()},h(){b(e,"class","validation-error svelte-zjv6iq")},m(s,o){B(s,e,o),l(e,r)},p(s,o){o[0]&64&&t!==(t=s[8].message+"")&&K(r,t)},d(s){s&&k(e)}}}function Ne(n){let e,t='<h4 class="svelte-zjv6iq">‚ÑπÔ∏è Intraclub Competition Rules</h4> <div style="color: #1e40af; font-size: 0.875rem;">You cannot rank your own entries in positions 1-3. Your entries are marked with a blue indicator.</div>';return{c(){e=C("div"),e.innerHTML=t,this.h()},l(r){e=j(r,"DIV",{class:!0,style:!0,"data-svelte-h":!0}),O(e)!=="svelte-d1dplj"&&(e.innerHTML=t),this.h()},h(){b(e,"class","validation-warning svelte-zjv6iq"),he(e,"background","#f0f9ff"),he(e,"border-color","#3b82f6")},m(r,s){B(r,e,s)},d(r){r&&k(e)}}}function et(n){let e,t=ne(n[0]),r=[];for(let s=0;s<t.length;s+=1)r[s]=He(qe(n,t,s));return{c(){e=C("div");for(let s=0;s<r.length;s+=1)r[s].c();this.h()},l(s){e=j(s,"DIV",{class:!0});var o=V(e);for(let i=0;i<r.length;i+=1)r[i].l(o);o.forEach(k),this.h()},h(){b(e,"class","rankings-list svelte-zjv6iq")},m(s,o){B(s,e,o);for(let i=0;i<r.length;i+=1)r[i]&&r[i].m(e,null)},p(s,o){if(o[0]&55813){t=ne(s[0]);let i;for(i=0;i<t.length;i+=1){const _=qe(s,t,i);r[i]?r[i].p(_,o):(r[i]=He(_),r[i].c(),r[i].m(e,null))}for(;i<r.length;i+=1)r[i].d(1);r.length=t.length}},d(s){s&&k(e),pe(r,s)}}}function tt(n){let e,t,r="No Scored Entries",s,o,i="You need to score entries in this category before you can rank them.",_,c,f,a;return{c(){e=C("div"),t=C("h3"),t.textContent=r,s=R(),o=C("p"),o.textContent=i,_=R(),c=C("a"),f=M("üèÜ Start Judging"),this.h()},l(q){e=j(q,"DIV",{class:!0});var d=V(e);t=j(d,"H3",{"data-svelte-h":!0}),O(t)!=="svelte-fdz8k3"&&(t.textContent=r),s=S(d),o=j(d,"P",{"data-svelte-h":!0}),O(o)!=="svelte-a9o4sh"&&(o.textContent=i),_=S(d),c=j(d,"A",{href:!0,class:!0});var y=V(c);f=G(y,"üèÜ Start Judging"),y.forEach(k),d.forEach(k),this.h()},h(){b(c,"href",a="/judge/competition/"+n[7]),b(c,"class","nav-btn nav-btn-primary svelte-zjv6iq"),b(e,"class","empty-state svelte-zjv6iq")},m(q,d){B(q,e,d),l(e,t),l(e,s),l(e,o),l(e,_),l(e,c),l(c,f)},p(q,d){d[0]&128&&a!==(a="/judge/competition/"+q[7])&&b(c,"href",a)},d(q){q&&k(e)}}}function Se(n){let e,t="üë§ Your Entry";return{c(){e=C("span"),e.textContent=t,this.h()},l(r){e=j(r,"SPAN",{class:!0,"data-svelte-h":!0}),O(e)!=="svelte-rptdas"&&(e.textContent=t),this.h()},h(){b(e,"class","own-entry-indicator svelte-zjv6iq")},m(r,s){B(r,e,s)},d(r){r&&k(e)}}}function Re(n){let e,t,r=n[30].entry.category_display+"",s;return{c(){e=C("div"),t=M("Category: "),s=M(r),this.h()},l(o){e=j(o,"DIV",{class:!0});var i=V(e);t=G(i,"Category: "),s=G(i,r),i.forEach(k),this.h()},h(){b(e,"class","detail-text svelte-zjv6iq")},m(o,i){B(o,e,i),l(e,t),l(e,s)},p(o,i){i[0]&1&&r!==(r=o[30].entry.category_display+"")&&K(s,r)},d(o){o&&k(e)}}}function Te(n){let e,t="üìù Has notes";return{c(){e=C("span"),e.textContent=t,this.h()},l(r){e=j(r,"SPAN",{class:!0,"data-svelte-h":!0}),O(e)!=="svelte-15x1uhx"&&(e.textContent=t),this.h()},h(){b(e,"class","detail-text svelte-zjv6iq")},m(r,s){B(r,e,s)},d(r){r&&k(e)}}}function He(n){var ye;let e,t,r=Ge(n[30].rank_position)+"",s,o,i,_,c,f=n[30].entry.entry_number+"",a,q,d=n[14](n[30].entry),y,g,m,u,p=n[9](n[30].entry.beer_name)+"",z,Q,X,T,D,N=n[30].entry.total_score+"",Y,Z,$,te,x,P,ae="‚¨ÜÔ∏è",ie,F,h,H,E,U,J,I,v=d&&Se(),w=((ye=n[2])==null?void 0:ye.isCustomGroup)&&Re(n),L=n[30].entry.judge_notes&&Te();function ve(){return n[20](n[32])}function Le(){return n[21](n[32])}return{c(){e=C("div"),t=C("div"),s=M(r),o=R(),i=C("div"),_=C("div"),c=M("Entry #"),a=M(f),q=R(),v&&v.c(),y=R(),g=C("div"),m=C("div"),u=C("strong"),z=M(p),Q=R(),w&&w.c(),X=R(),T=C("div"),D=C("span"),Y=M(N),Z=M("/50"),$=R(),L&&L.c(),te=R(),x=C("div"),P=C("button"),P.textContent=ae,ie=R(),F=C("button"),h=M("‚¨áÔ∏è"),E=R(),this.h()},l(ee){e=j(ee,"DIV",{class:!0});var A=V(e);t=j(A,"DIV",{class:!0});var oe=V(t);s=G(oe,r),oe.forEach(k),o=S(A),i=j(A,"DIV",{class:!0});var re=V(i);_=j(re,"DIV",{class:!0});var se=V(_);c=G(se,"Entry #"),a=G(se,f),q=S(se),v&&v.l(se),se.forEach(k),y=S(re),g=j(re,"DIV",{class:!0});var ce=V(g);m=j(ce,"DIV",{class:!0});var be=V(m);u=j(be,"STRONG",{});var ke=V(u);z=G(ke,p),ke.forEach(k),be.forEach(k),Q=S(ce),w&&w.l(ce),ce.forEach(k),X=S(re),T=j(re,"DIV",{class:!0});var de=V(T);D=j(de,"SPAN",{class:!0,style:!0});var ge=V(D);Y=G(ge,N),Z=G(ge,"/50"),ge.forEach(k),$=S(de),L&&L.l(de),de.forEach(k),re.forEach(k),te=S(A),x=j(A,"DIV",{class:!0});var ue=V(x);P=j(ue,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),O(P)!=="svelte-4hx6ed"&&(P.textContent=ae),ie=S(ue),F=j(ue,"BUTTON",{class:!0,title:!0});var je=V(F);h=G(je,"‚¨áÔ∏è"),je.forEach(k),ue.forEach(k),E=S(A),A.forEach(k),this.h()},h(){b(t,"class","rank-position svelte-zjv6iq"),b(_,"class","entry-number svelte-zjv6iq"),b(m,"class","detail-text svelte-zjv6iq"),b(g,"class","entry-details svelte-zjv6iq"),b(D,"class","score-badge svelte-zjv6iq"),he(D,"background",Me(n[30].entry.total_score)),b(T,"class","score-display svelte-zjv6iq"),b(i,"class","entry-info svelte-zjv6iq"),b(P,"class","rank-btn svelte-zjv6iq"),P.disabled=n[32]===0,b(P,"title","Move up"),b(F,"class","rank-btn svelte-zjv6iq"),F.disabled=H=n[32]===n[0].length-1,b(F,"title","Move down"),b(x,"class","ranking-controls svelte-zjv6iq"),b(e,"class",U="ranking-item "+(n[14](n[30].entry)?"own-entry":"")+" "+n[15](n[30])+" svelte-zjv6iq")},m(ee,A){B(ee,e,A),l(e,t),l(t,s),l(e,o),l(e,i),l(i,_),l(_,c),l(_,a),l(_,q),v&&v.m(_,null),l(i,y),l(i,g),l(g,m),l(m,u),l(u,z),l(g,Q),w&&w.m(g,null),l(i,X),l(i,T),l(T,D),l(D,Y),l(D,Z),l(T,$),L&&L.m(T,null),l(e,te),l(e,x),l(x,P),l(x,ie),l(x,F),l(F,h),l(e,E),J||(I=[le(P,"click",ve),le(F,"click",Le)],J=!0)},p(ee,A){var oe;n=ee,A[0]&1&&r!==(r=Ge(n[30].rank_position)+"")&&K(s,r),A[0]&1&&f!==(f=n[30].entry.entry_number+"")&&K(a,f),A[0]&1&&(d=n[14](n[30].entry)),d?v||(v=Se(),v.c(),v.m(_,null)):v&&(v.d(1),v=null),A[0]&1&&p!==(p=n[9](n[30].entry.beer_name)+"")&&K(z,p),(oe=n[2])!=null&&oe.isCustomGroup?w?w.p(n,A):(w=Re(n),w.c(),w.m(g,null)):w&&(w.d(1),w=null),A[0]&1&&N!==(N=n[30].entry.total_score+"")&&K(Y,N),A[0]&1&&he(D,"background",Me(n[30].entry.total_score)),n[30].entry.judge_notes?L||(L=Te(),L.c(),L.m(T,null)):L&&(L.d(1),L=null),A[0]&1&&H!==(H=n[32]===n[0].length-1)&&(F.disabled=H),A[0]&1&&U!==(U="ranking-item "+(n[14](n[30].entry)?"own-entry":"")+" "+n[15](n[30])+" svelte-zjv6iq")&&b(e,"class",U)},d(ee){ee&&k(e),v&&v.d(),w&&w.d(),L&&L.d(),J=!1,Be(I)}}}function rt(n){let e,t,r='<h1 class="svelte-zjv6iq">üèÜ Category Rankings</h1> <p class="svelte-zjv6iq">Rank entries within each category based on your judging scores</p>',s,o,i,_,c,f,a,q="üè† Judge Portal",d;function y(u,p){return u[3]?$e:u[8]?xe:u[1].length===0?Ze:Xe}let g=y(n),m=g(n);return{c(){e=C("div"),t=C("div"),t.innerHTML=r,s=R(),o=C("div"),i=C("a"),_=M("‚¨ÖÔ∏è Back to Judging"),f=R(),a=C("a"),a.textContent=q,d=R(),m.c(),this.h()},l(u){e=j(u,"DIV",{class:!0});var p=V(e);t=j(p,"DIV",{class:!0,"data-svelte-h":!0}),O(t)!=="svelte-k61t7l"&&(t.innerHTML=r),s=S(p),o=j(p,"DIV",{class:!0});var z=V(o);i=j(z,"A",{href:!0,class:!0});var Q=V(i);_=G(Q,"‚¨ÖÔ∏è Back to Judging"),Q.forEach(k),f=S(z),a=j(z,"A",{href:!0,class:!0,"data-svelte-h":!0}),O(a)!=="svelte-wz4wfi"&&(a.textContent=q),z.forEach(k),d=S(p),m.l(p),p.forEach(k),this.h()},h(){b(t,"class","header svelte-zjv6iq"),b(i,"href",c="/judge/competition/"+n[7]),b(i,"class","nav-btn svelte-zjv6iq"),b(a,"href","/judge"),b(a,"class","nav-btn svelte-zjv6iq"),b(o,"class","nav-buttons svelte-zjv6iq"),b(e,"class","rankings-container svelte-zjv6iq")},m(u,p){B(u,e,p),l(e,t),l(e,s),l(e,o),l(o,i),l(i,_),l(o,f),l(o,a),l(e,d),m.m(e,null)},p(u,p){p[0]&128&&c!==(c="/judge/competition/"+u[7])&&b(i,"href",c),g===(g=y(u))&&m?m.p(u,p):(m.d(1),m=g(u),m&&(m.c(),m.m(e,null)))},i:fe,o:fe,d(u){u&&k(e),m.d()}}}function Ge(n){switch(n){case 1:return"ü•á";case 2:return"ü•à";case 3:return"ü•â";default:return`${n}.`}}function Me(n){return n>=45?"#059669":n>=38?"#0891b2":n>=30?"#eab308":n>=21?"#f59e0b":"#dc2626"}function me(n,e="info"){const t=document.createElement("div");t.textContent=n,t.style.cssText=`
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 1rem 1.5rem;
      border-radius: 6px;
      color: white;
      font-weight: 500;
      z-index: 1000;
      background: ${e==="success"?"#059669":e==="error"?"#dc2626":"#6b7280"};
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    `,document.body.appendChild(t),setTimeout(()=>document.body.removeChild(t),3e3)}function nt(n,e,t){let r,s,o,i,_,c;_e(n,Fe,h=>t(16,o=h)),_e(n,We,h=>t(24,i=h)),_e(n,Ke,h=>t(25,_=h)),_e(n,Pe,h=>t(17,c=h));let f=[],a=null,q=[],d=[],y=!0,g=!1,m=null,u=null,p=[];function z(h){return s?h||"No name provided":"Hidden"}Ae(async()=>{var h;if(!o){Ye("/auth");return}if(!_||((h=i.activeCompetition)==null?void 0:h.id)!==r)try{await Qe.startJudgingSession(r,o.id)}catch(H){console.error("Error starting judging session:",H),t(8,m="Failed to start judging session"),t(3,y=!1);return}await Q()});async function Q(){t(3,y=!0),t(8,m=null);try{const{data:h,error:H}=await W.from("competitions").select("category_system, competition_type").eq("id",r).single();if(H)throw H;if(t(5,u=h.competition_type),h.category_system==="custom"){const{data:E,error:U}=await W.from("competition_ranking_groups").select(`
            id, group_name, group_description, bjcp_category_ids, group_order
          `).eq("competition_id",r).order("group_order");if(U)throw U;const J=[];for(const I of E||[]){const v=I.bjcp_category_ids,{data:w,error:L}=await W.from("competition_entries").select("id, bjcp_category_id").eq("competition_id",r).in("bjcp_category_id",v);if(L)throw L;w&&w.length>0&&J.push({...I,isCustomGroup:!0,entryCount:w.length,displayName:I.group_name})}t(1,f=J)}else{const{data:E,error:U}=await W.from("competition_entries").select(`
            bjcp_category_id,
            bjcp_categories(
              id, category_number, subcategory_letter, 
              subcategory_name, category_name
            )
          `).eq("competition_id",r);if(U)throw U;const J=new Map;E.forEach(I=>{const v=I.bjcp_categories;if(v){const w=v.id;J.has(w)?J.get(w).entryCount++:J.set(w,{...v,isCustomGroup:!1,entryCount:1,displayName:`${v.category_number}${v.subcategory_letter||""} - ${v.category_name}${v.subcategory_name?` (${v.subcategory_name})`:""}`})}}),t(1,f=Array.from(J.values()).sort((I,v)=>I.category_number.localeCompare(v.category_number)))}f.length>0&&(t(2,a=f[0]),await X())}catch(h){console.error("Error loading categories:",h),t(8,m=h.message)}finally{t(3,y=!1)}}async function X(){if(a)try{let h;if(a.isCustomGroup){const{data:I,error:v}=await W.from("competition_entries").select(`
            id, entry_number, beer_name, beer_notes, bjcp_category_id, member_id,
            members!competition_entries_member_id_fkey(name),
            bjcp_categories!competition_entries_bjcp_category_id_fkey(
              category_number, subcategory_letter, subcategory_name, category_name
            )
          `).eq("competition_id",r).in("bjcp_category_id",a.bjcp_category_ids).order("entry_number");if(v)throw v;h=I}else{const{data:I,error:v}=await W.from("competition_entries").select(`
            id, entry_number, beer_name, beer_notes, bjcp_category_id, member_id,
            members!competition_entries_member_id_fkey(name),
            bjcp_categories!competition_entries_bjcp_category_id_fkey(
              category_number, subcategory_letter, subcategory_name, category_name
            )
          `).eq("competition_id",r).eq("bjcp_category_id",a.id).order("entry_number");if(v)throw v;h=I}if(!h)throw new Error("No entries data loaded");const H=h.map(I=>I.id),{data:E,error:U}=await W.from("competition_judging_sessions").select("entry_id, total_score, judge_notes").eq("competition_id",r).eq("judge_id",o.id).in("entry_id",H);U&&console.warn("No judging data found:",U);let J=[];if(a.isCustomGroup){const{data:I,error:v}=await W.from("competition_rankings").select("*").eq("competition_id",r).eq("judge_id",o.id).eq("ranking_group_id",a.id).order("rank_position");v?console.warn("No existing group rankings found:",v):J=I}else{const{data:I,error:v}=await W.from("competition_rankings").select("*").eq("competition_id",r).eq("judge_id",o.id).eq("bjcp_category_id",a.id).order("rank_position");v?console.warn("No existing category rankings found:",v):J=I}if(q=h.map(I=>{var L;const v=E==null?void 0:E.find(ve=>ve.entry_id===I.id),w=I.bjcp_categories;return{...I,member_name:((L=I.members)==null?void 0:L.name)||"Unknown",total_score:(v==null?void 0:v.total_score)||0,judge_notes:(v==null?void 0:v.judge_notes)||"",hasScore:!!(v!=null&&v.total_score),category_display:w?`${w.category_number}${w.subcategory_letter||""} - ${w.subcategory_name||w.category_name}`:"Unknown Category"}}),J&&J.length>0)t(0,d=J.map(I=>{const v=q.find(w=>w.id===I.entry_id);return{...I,entry:v}}));else{const I=q.filter(v=>v.hasScore).sort((v,w)=>w.total_score-v.total_score);t(0,d=I.map((v,w)=>({id:null,competition_id:r,judge_id:o.id,bjcp_category_id:a.isCustomGroup?null:a.id,ranking_group_id:a.isCustomGroup?a.id:null,entry_id:v.id,rank_position:w+1,ranking_notes:"",entry:v})))}}catch(h){console.error("Error loading category entries:",h),t(8,m=h.message)}}async function T(h){t(2,a=h),await X()}function D(h,H){if(h===H||H<0||H>=d.length)return;const E=[...d],[U]=E.splice(h,1);E.splice(H,0,U),E.forEach((J,I)=>{J.rank_position=I+1}),t(0,d=E)}function N(h){D(h,h-1)}function Y(h){D(h,h+1)}function Z(){if(t(6,p=[]),u!=="intraclub")return!0;const H=d.filter(E=>E.rank_position<=3).filter(E=>E.entry&&E.entry.member_id===o.id);return H.length>0?(H.forEach(E=>{p.push({type:"self_ranking",message:`You cannot rank your own entry (#${E.entry.entry_number}) in position ${E.rank_position} during intraclub competitions.`,entryId:E.entry_id,position:E.rank_position})}),!1):!0}async function $(){if(!(!a||d.length===0)){if(!Z()){me("Cannot save: You cannot rank your own entries in positions 1-3 during intraclub competitions","error");return}t(4,g=!0);try{if(a.isCustomGroup){const{error:E}=await W.from("competition_rankings").delete().eq("competition_id",r).eq("judge_id",o.id).eq("ranking_group_id",a.id);if(E)throw E}else{const{error:E}=await W.from("competition_rankings").delete().eq("competition_id",r).eq("judge_id",o.id).eq("bjcp_category_id",a.id);if(E)throw E}const h=d.map(E=>({competition_id:r,judge_id:o.id,bjcp_category_id:a.isCustomGroup?null:a.id,ranking_group_id:a.isCustomGroup?a.id:null,entry_id:E.entry_id,rank_position:E.rank_position,ranking_notes:E.ranking_notes||null})),{error:H}=await W.from("competition_rankings").insert(h);if(H)throw H;me("Rankings saved successfully!","success")}catch(h){console.error("Error saving rankings:",h),me("Failed to save rankings","error")}finally{t(4,g=!1)}}}function te(h){return h&&h.member_id===(o==null?void 0:o.id)}function x(h){return u==="intraclub"&&te(h.entry)&&h.rank_position<=3?"invalid-own-entry":""}const P=()=>window.location.reload(),ae=h=>T(h),ie=h=>N(h),F=h=>Y(h);return n.$$.update=()=>{n.$$.dirty[0]&131072&&t(7,r=c.params.id),n.$$.dirty[0]&65536&&(s=(o==null?void 0:o.role)==="competition_director"),n.$$.dirty[0]&1&&d.length>0&&Z()},[d,f,a,y,g,u,p,r,m,z,T,N,Y,$,te,x,o,c,P,ae,ie,F]}class _t extends Ue{constructor(e){super(),Oe(this,e,nt,rt,Je,{},null,[-1,-1])}}export{_t as component};
