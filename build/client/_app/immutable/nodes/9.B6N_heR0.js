import{s as Te,n as ae,d as p,q as v,i as U,b as n,c as q,e as w,v as K,g as N,f as V,h as E,j as T,t as S,k as le,w as Re,a as G,p as te,y as Ve,z as pe,r as He,G as be}from"../chunks/DOvoZ9Ia.js";import{e as oe}from"../chunks/DJwZhPfI.js";import{S as Me,i as Je}from"../chunks/DZMW2zPD.js";import{g as Le}from"../chunks/F2-QbuOs.js";import{p as Be}from"../chunks/BwSWz2JU.js";import{u as Pe}from"../chunks/DP1yl1qp.js";import{a as Ae,i as Ue,c as Oe}from"../chunks/z-QhZtwN.js";import{s as $}from"../chunks/CCM_4jRA.js";function ye(r,e,t){const s=r.slice();return s[23]=e[t],s[25]=t,s}function ke(r,e,t){const s=r.slice();return s[26]=e[t],s}function ze(r){let e,t,s,a=r[0].length+"",u,l,k,c,b,y,m=oe(r[0]),o=[];for(let d=0;d<m.length;d+=1)o[d]=qe(ke(r,m,d));let _=r[1]&&Ee(r);return{c(){e=E("div"),t=E("h2"),s=S("Select Category to Rank ("),u=S(a),l=S(" categories)"),k=T(),c=E("div");for(let d=0;d<o.length;d+=1)o[d].c();b=T(),_&&_.c(),y=pe(),this.h()},l(d){e=q(d,"DIV",{class:!0});var f=w(e);t=q(f,"H2",{});var i=w(t);s=V(i,"Select Category to Rank ("),u=V(i,a),l=V(i," categories)"),i.forEach(p),k=N(f),c=q(f,"DIV",{class:!0});var g=w(c);for(let C=0;C<o.length;C+=1)o[C].l(g);g.forEach(p),f.forEach(p),b=N(d),_&&_.l(d),y=pe(),this.h()},h(){v(c,"class","categories-grid svelte-136mq3c"),v(e,"class","categories-section svelte-136mq3c")},m(d,f){U(d,e,f),n(e,t),n(t,s),n(t,u),n(t,l),n(e,k),n(e,c);for(let i=0;i<o.length;i+=1)o[i]&&o[i].m(c,null);U(d,b,f),_&&_.m(d,f),U(d,y,f)},p(d,f){if(f&1&&a!==(a=d[0].length+"")&&G(u,a),f&131){m=oe(d[0]);let i;for(i=0;i<m.length;i+=1){const g=ke(d,m,i);o[i]?o[i].p(g,f):(o[i]=qe(g),o[i].c(),o[i].m(c,null))}for(;i<o.length;i+=1)o[i].d(1);o.length=m.length}d[1]?_?_.p(d,f):(_=Ee(d),_.c(),_.m(y.parentNode,y)):_&&(_.d(1),_=null)},d(d){d&&(p(e),p(b),p(y)),Ve(o,d),_&&_.d(d)}}}function Fe(r){let e,t="<h3>No Categories Found</h3> <p>No entries have been submitted for this competition yet.</p>";return{c(){e=E("div"),e.innerHTML=t,this.h()},l(s){e=q(s,"DIV",{class:!0,"data-svelte-h":!0}),K(e)!=="svelte-1c7kpl1"&&(e.innerHTML=t),this.h()},h(){v(e,"class","empty-state svelte-136mq3c")},m(s,a){U(s,e,a)},p:ae,d(s){s&&p(e)}}}function Ge(r){let e,t,s="Error Loading Data",a,u,l,k,c,b="🔄 Retry",y,m;return{c(){e=E("div"),t=E("h3"),t.textContent=s,a=T(),u=E("p"),l=S(r[5]),k=T(),c=E("button"),c.textContent=b,this.h()},l(o){e=q(o,"DIV",{class:!0});var _=w(e);t=q(_,"H3",{"data-svelte-h":!0}),K(t)!=="svelte-14daeti"&&(t.textContent=s),a=N(_),u=q(_,"P",{});var d=w(u);l=V(d,r[5]),d.forEach(p),k=N(_),c=q(_,"BUTTON",{class:!0,"data-svelte-h":!0}),K(c)!=="svelte-k0kltk"&&(c.textContent=b),_.forEach(p),this.h()},h(){v(c,"class","nav-btn nav-btn-primary svelte-136mq3c"),v(e,"class","error-state svelte-136mq3c")},m(o,_){U(o,e,_),n(e,t),n(e,a),n(e,u),n(u,l),n(e,k),n(e,c),y||(m=te(c,"click",r[12]),y=!0)},p(o,_){_&32&&G(l,o[5])},d(o){o&&p(e),y=!1,m()}}}function Ye(r){let e,t='<div class="spinner svelte-136mq3c"></div> <p>Loading categories and rankings...</p>';return{c(){e=E("div"),e.innerHTML=t,this.h()},l(s){e=q(s,"DIV",{class:!0,"data-svelte-h":!0}),K(e)!=="svelte-gsq85"&&(e.innerHTML=t),this.h()},h(){v(e,"class","loading svelte-136mq3c")},m(s,a){U(s,e,a)},p:ae,d(s){s&&p(e)}}}function qe(r){let e,t,s=r[26].displayName+"",a,u,l,k=r[26].entryCount+"",c,b,y,m,o,_;function d(){return r[13](r[26])}return{c(){e=E("div"),t=E("div"),a=S(s),u=T(),l=E("div"),c=S(k),b=S(" entries"),y=T(),this.h()},l(f){e=q(f,"DIV",{class:!0,role:!0,tabindex:!0});var i=w(e);t=q(i,"DIV",{class:!0});var g=w(t);a=V(g,s),g.forEach(p),u=N(i),l=q(i,"DIV",{class:!0});var C=w(l);c=V(C,k),b=V(C," entries"),C.forEach(p),y=N(i),i.forEach(p),this.h()},h(){var f;v(t,"class","category-name svelte-136mq3c"),v(l,"class","category-stats svelte-136mq3c"),v(e,"class",m="category-card "+(((f=r[1])==null?void 0:f.id)===r[26].id?"selected":"")+" svelte-136mq3c"),v(e,"role","button"),v(e,"tabindex","0")},m(f,i){U(f,e,i),n(e,t),n(t,a),n(e,u),n(e,l),n(l,c),n(l,b),n(e,y),o||(_=te(e,"click",d),o=!0)},p(f,i){var g;r=f,i&1&&s!==(s=r[26].displayName+"")&&G(a,s),i&1&&k!==(k=r[26].entryCount+"")&&G(c,k),i&3&&m!==(m="category-card "+(((g=r[1])==null?void 0:g.id)===r[26].id?"selected":"")+" svelte-136mq3c")&&v(e,"class",m)},d(f){f&&p(e),o=!1,_()}}}function Ee(r){let e,t,s,a,u=r[1].displayName+"",l,k,c,b=r[4]?"Saving...":"Save Rankings",y,m,o,_,d;function f(C,j){return C[2].length===0?Qe:Ke}let i=f(r),g=i(r);return{c(){e=E("div"),t=E("div"),s=E("h2"),a=S("Rankings for "),l=S(u),k=T(),c=E("button"),y=S(b),o=T(),g.c(),this.h()},l(C){e=q(C,"DIV",{class:!0});var j=w(e);t=q(j,"DIV",{class:!0});var A=w(t);s=q(A,"H2",{class:!0});var Y=w(s);a=V(Y,"Rankings for "),l=V(Y,u),Y.forEach(p),k=N(A),c=q(A,"BUTTON",{class:!0});var Q=w(c);y=V(Q,b),Q.forEach(p),A.forEach(p),o=N(j),g.l(j),j.forEach(p),this.h()},h(){v(s,"class","svelte-136mq3c"),v(c,"class","save-btn svelte-136mq3c"),c.disabled=m=r[4]||r[2].length===0,v(t,"class","rankings-header svelte-136mq3c"),v(e,"class","rankings-section svelte-136mq3c")},m(C,j){U(C,e,j),n(e,t),n(t,s),n(s,a),n(s,l),n(t,k),n(t,c),n(c,y),n(e,o),g.m(e,null),_||(d=te(c,"click",r[10]),_=!0)},p(C,j){j&2&&u!==(u=C[1].displayName+"")&&G(l,u),j&16&&b!==(b=C[4]?"Saving...":"Save Rankings")&&G(y,b),j&20&&m!==(m=C[4]||C[2].length===0)&&(c.disabled=m),i===(i=f(C))&&g?g.p(C,j):(g.d(1),g=i(C),g&&(g.c(),g.m(e,null)))},d(C){C&&p(e),g.d(),_=!1,d()}}}function Ke(r){let e,t=oe(r[2]),s=[];for(let a=0;a<t.length;a+=1)s[a]=we(ye(r,t,a));return{c(){e=E("div");for(let a=0;a<s.length;a+=1)s[a].c();this.h()},l(a){e=q(a,"DIV",{class:!0});var u=w(e);for(let l=0;l<s.length;l+=1)s[l].l(u);u.forEach(p),this.h()},h(){v(e,"class","rankings-list svelte-136mq3c")},m(a,u){U(a,e,u);for(let l=0;l<s.length;l+=1)s[l]&&s[l].m(e,null)},p(a,u){if(u&772){t=oe(a[2]);let l;for(l=0;l<t.length;l+=1){const k=ye(a,t,l);s[l]?s[l].p(k,u):(s[l]=we(k),s[l].c(),s[l].m(e,null))}for(;l<s.length;l+=1)s[l].d(1);s.length=t.length}},d(a){a&&p(e),Ve(s,a)}}}function Qe(r){let e,t,s="No Scored Entries",a,u,l="You need to score entries in this category before you can rank them.",k,c,b,y;return{c(){e=E("div"),t=E("h3"),t.textContent=s,a=T(),u=E("p"),u.textContent=l,k=T(),c=E("a"),b=S("🏆 Start Judging"),this.h()},l(m){e=q(m,"DIV",{class:!0});var o=w(e);t=q(o,"H3",{"data-svelte-h":!0}),K(t)!=="svelte-fdz8k3"&&(t.textContent=s),a=N(o),u=q(o,"P",{"data-svelte-h":!0}),K(u)!=="svelte-a9o4sh"&&(u.textContent=l),k=N(o),c=q(o,"A",{href:!0,class:!0});var _=w(c);b=V(_,"🏆 Start Judging"),_.forEach(p),o.forEach(p),this.h()},h(){v(c,"href",y="/judge/competition/"+r[6]),v(c,"class","nav-btn nav-btn-primary svelte-136mq3c"),v(e,"class","empty-state svelte-136mq3c")},m(m,o){U(m,e,o),n(e,t),n(e,a),n(e,u),n(e,k),n(e,c),n(c,b)},p(m,o){o&64&&y!==(y="/judge/competition/"+m[6])&&v(c,"href",y)},d(m){m&&p(e)}}}function Ce(r){let e,t="📝 Has notes";return{c(){e=E("span"),e.textContent=t,this.h()},l(s){e=q(s,"SPAN",{class:!0,"data-svelte-h":!0}),K(e)!=="svelte-15x1uhx"&&(e.textContent=t),this.h()},h(){v(e,"class","detail-text svelte-136mq3c")},m(s,a){U(s,e,a)},d(s){s&&p(e)}}}function we(r){let e,t,s=De(r[23].rank_position)+"",a,u,l,k,c,b=r[23].entry.entry_number+"",y,m,o,_,d,f=(r[23].entry.beer_name||"No name")+"",i,g,C,j,A=r[23].entry.member_name+"",Y,Q,z,F,W=r[23].entry.total_score+"",h,H,M,J,I,R,ee="⬆️",P,D,O,Z,ie,ce,fe,B=r[23].entry.judge_notes&&Ce();function Se(){return r[14](r[25])}function Ne(){return r[15](r[25])}return{c(){e=E("div"),t=E("div"),a=S(s),u=T(),l=E("div"),k=E("div"),c=S("Entry #"),y=S(b),m=T(),o=E("div"),_=E("div"),d=E("strong"),i=S(f),g=T(),C=E("div"),j=S("Brewer: "),Y=S(A),Q=T(),z=E("div"),F=E("span"),h=S(W),H=S("/50"),M=T(),B&&B.c(),J=T(),I=E("div"),R=E("button"),R.textContent=ee,P=T(),D=E("button"),O=S("⬇️"),ie=T(),this.h()},l(X){e=q(X,"DIV",{class:!0});var L=w(e);t=q(L,"DIV",{class:!0});var he=w(t);a=V(he,s),he.forEach(p),u=N(L),l=q(L,"DIV",{class:!0});var x=w(l);k=q(x,"DIV",{class:!0});var de=w(k);c=V(de,"Entry #"),y=V(de,b),de.forEach(p),m=N(x),o=q(x,"DIV",{class:!0});var re=w(o);_=q(re,"DIV",{class:!0});var ve=w(_);d=q(ve,"STRONG",{});var me=w(d);i=V(me,f),me.forEach(p),ve.forEach(p),g=N(re),C=q(re,"DIV",{class:!0});var ue=w(C);j=V(ue,"Brewer: "),Y=V(ue,A),ue.forEach(p),re.forEach(p),Q=N(x),z=q(x,"DIV",{class:!0});var se=w(z);F=q(se,"SPAN",{class:!0,style:!0});var _e=w(F);h=V(_e,W),H=V(_e,"/50"),_e.forEach(p),M=N(se),B&&B.l(se),se.forEach(p),x.forEach(p),J=N(L),I=q(L,"DIV",{class:!0});var ne=w(I);R=q(ne,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),K(R)!=="svelte-4hx6ed"&&(R.textContent=ee),P=N(ne),D=q(ne,"BUTTON",{class:!0,title:!0});var ge=w(D);O=V(ge,"⬇️"),ge.forEach(p),ne.forEach(p),ie=N(L),L.forEach(p),this.h()},h(){v(t,"class","rank-position svelte-136mq3c"),v(k,"class","entry-number svelte-136mq3c"),v(_,"class","detail-text svelte-136mq3c"),v(C,"class","detail-text svelte-136mq3c"),v(o,"class","entry-details svelte-136mq3c"),v(F,"class","score-badge svelte-136mq3c"),be(F,"background",Ie(r[23].entry.total_score)),v(z,"class","score-display svelte-136mq3c"),v(l,"class","entry-info svelte-136mq3c"),v(R,"class","rank-btn svelte-136mq3c"),R.disabled=r[25]===0,v(R,"title","Move up"),v(D,"class","rank-btn svelte-136mq3c"),D.disabled=Z=r[25]===r[2].length-1,v(D,"title","Move down"),v(I,"class","ranking-controls svelte-136mq3c"),v(e,"class","ranking-item svelte-136mq3c")},m(X,L){U(X,e,L),n(e,t),n(t,a),n(e,u),n(e,l),n(l,k),n(k,c),n(k,y),n(l,m),n(l,o),n(o,_),n(_,d),n(d,i),n(o,g),n(o,C),n(C,j),n(C,Y),n(l,Q),n(l,z),n(z,F),n(F,h),n(F,H),n(z,M),B&&B.m(z,null),n(e,J),n(e,I),n(I,R),n(I,P),n(I,D),n(D,O),n(e,ie),ce||(fe=[te(R,"click",Se),te(D,"click",Ne)],ce=!0)},p(X,L){r=X,L&4&&s!==(s=De(r[23].rank_position)+"")&&G(a,s),L&4&&b!==(b=r[23].entry.entry_number+"")&&G(y,b),L&4&&f!==(f=(r[23].entry.beer_name||"No name")+"")&&G(i,f),L&4&&A!==(A=r[23].entry.member_name+"")&&G(Y,A),L&4&&W!==(W=r[23].entry.total_score+"")&&G(h,W),L&4&&be(F,"background",Ie(r[23].entry.total_score)),r[23].entry.judge_notes?B||(B=Ce(),B.c(),B.m(z,null)):B&&(B.d(1),B=null),L&4&&Z!==(Z=r[25]===r[2].length-1)&&(D.disabled=Z)},d(X){X&&p(e),B&&B.d(),ce=!1,He(fe)}}}function We(r){let e,t,s='<h1 class="svelte-136mq3c">🏆 Category Rankings</h1> <p class="svelte-136mq3c">Rank entries within each category based on your judging scores</p>',a,u,l,k,c,b,y,m="🏠 Judge Portal",o;function _(i,g){return i[3]?Ye:i[5]?Ge:i[0].length===0?Fe:ze}let d=_(r),f=d(r);return{c(){e=E("div"),t=E("div"),t.innerHTML=s,a=T(),u=E("div"),l=E("a"),k=S("⬅️ Back to Judging"),b=T(),y=E("a"),y.textContent=m,o=T(),f.c(),this.h()},l(i){e=q(i,"DIV",{class:!0});var g=w(e);t=q(g,"DIV",{class:!0,"data-svelte-h":!0}),K(t)!=="svelte-k61t7l"&&(t.innerHTML=s),a=N(g),u=q(g,"DIV",{class:!0});var C=w(u);l=q(C,"A",{href:!0,class:!0});var j=w(l);k=V(j,"⬅️ Back to Judging"),j.forEach(p),b=N(C),y=q(C,"A",{href:!0,class:!0,"data-svelte-h":!0}),K(y)!=="svelte-wz4wfi"&&(y.textContent=m),C.forEach(p),o=N(g),f.l(g),g.forEach(p),this.h()},h(){v(t,"class","header svelte-136mq3c"),v(l,"href",c="/judge/competition/"+r[6]),v(l,"class","nav-btn svelte-136mq3c"),v(y,"href","/judge"),v(y,"class","nav-btn svelte-136mq3c"),v(u,"class","nav-buttons svelte-136mq3c"),v(e,"class","rankings-container svelte-136mq3c")},m(i,g){U(i,e,g),n(e,t),n(e,a),n(e,u),n(u,l),n(l,k),n(u,b),n(u,y),n(e,o),f.m(e,null)},p(i,[g]){g&64&&c!==(c="/judge/competition/"+i[6])&&v(l,"href",c),d===(d=_(i))&&f?f.p(i,g):(f.d(1),f=d(i),f&&(f.c(),f.m(e,null)))},i:ae,o:ae,d(i){i&&p(e),f.d()}}}function De(r){switch(r){case 1:return"🥇";case 2:return"🥈";case 3:return"🥉";default:return`${r}.`}}function Ie(r){return r>=45?"#059669":r>=38?"#0891b2":r>=30?"#eab308":r>=21?"#f59e0b":"#dc2626"}function je(r,e="info"){const t=document.createElement("div");t.textContent=r,t.style.cssText=`
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 1rem 1.5rem;
      border-radius: 6px;
      color: white;
      font-weight: 500;
      z-index: 1000;
      background: ${e==="success"?"#059669":e==="error"?"#dc2626":"#6b7280"};
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    `,document.body.appendChild(t),setTimeout(()=>document.body.removeChild(t),3e3)}function Xe(r,e,t){let s,a,u,l,k;le(r,Pe,h=>t(17,a=h)),le(r,Ae,h=>t(18,u=h)),le(r,Ue,h=>t(19,l=h)),le(r,Be,h=>t(11,k=h));let c=[],b=null,y=[],m=[],o=!0,_=!1,d=null;Re(async()=>{var h;if(!a){Le("/auth");return}if(!l||((h=u.activeCompetition)==null?void 0:h.id)!==s)try{await Oe.startJudgingSession(s,a.id)}catch(H){console.error("Error starting judging session:",H),t(5,d="Failed to start judging session"),t(3,o=!1);return}await f()});async function f(){t(3,o=!0),t(5,d=null);try{const{data:h,error:H}=await $.from("competition_entries").select(`
          bjcp_category_id,
          bjcp_categories(
            id, category_number, subcategory_letter, 
            subcategory_name, category_name
          )
        `).eq("competition_id",s);if(H)throw H;const M=new Map;h.forEach(J=>{const I=J.bjcp_categories;if(I){const R=I.id;M.has(R)?M.get(R).entryCount++:M.set(R,{...I,entryCount:1,displayName:`${I.category_number}${I.subcategory_letter||""} - ${I.category_name}${I.subcategory_name?` (${I.subcategory_name})`:""}`})}}),t(0,c=Array.from(M.values()).sort((J,I)=>J.category_number.localeCompare(I.category_number))),c.length>0&&(t(1,b=c[0]),await i())}catch(h){console.error("Error loading categories:",h),t(5,d=h.message)}finally{t(3,o=!1)}}async function i(){if(b)try{const{data:h,error:H}=await $.from("competition_entries").select(`
          id, entry_number, beer_name, beer_notes,
          members!competition_entries_member_id_fkey(name)
        `).eq("competition_id",s).eq("bjcp_category_id",b.id).order("entry_number");if(H)throw H;const M=h.map(P=>P.id),{data:J,error:I}=await $.from("competition_judging_sessions").select("entry_id, total_score, judge_notes").eq("competition_id",s).eq("judge_id",a.id).in("entry_id",M);I&&console.warn("No judging data found:",I);const{data:R,error:ee}=await $.from("competition_rankings").select("*").eq("competition_id",s).eq("judge_id",a.id).eq("bjcp_category_id",b.id).order("rank_position");if(ee&&console.warn("No existing rankings found:",ee),y=h.map(P=>{var O;const D=J==null?void 0:J.find(Z=>Z.entry_id===P.id);return{...P,member_name:((O=P.members)==null?void 0:O.name)||"Unknown",total_score:(D==null?void 0:D.total_score)||0,judge_notes:(D==null?void 0:D.judge_notes)||"",hasScore:!!(D!=null&&D.total_score)}}),R&&R.length>0)t(2,m=R.map(P=>{const D=y.find(O=>O.id===P.entry_id);return{...P,entry:D}}));else{const P=y.filter(D=>D.hasScore).sort((D,O)=>O.total_score-D.total_score);t(2,m=P.map((D,O)=>({id:null,competition_id:s,judge_id:a.id,bjcp_category_id:b.id,entry_id:D.id,rank_position:O+1,ranking_notes:"",entry:D})))}}catch(h){console.error("Error loading category entries:",h),t(5,d=h.message)}}async function g(h){t(1,b=h),await i()}function C(h,H){if(h===H||H<0||H>=m.length)return;const M=[...m],[J]=M.splice(h,1);M.splice(H,0,J),M.forEach((I,R)=>{I.rank_position=R+1}),t(2,m=M)}function j(h){C(h,h-1)}function A(h){C(h,h+1)}async function Y(){if(!(!b||m.length===0)){t(4,_=!0);try{const{error:h}=await $.from("competition_rankings").delete().eq("competition_id",s).eq("judge_id",a.id).eq("bjcp_category_id",b.id);if(h)throw h;const H=m.map(J=>({competition_id:s,judge_id:a.id,bjcp_category_id:b.id,entry_id:J.entry_id,rank_position:J.rank_position,ranking_notes:J.ranking_notes||null})),{error:M}=await $.from("competition_rankings").insert(H);if(M)throw M;je("Rankings saved successfully!","success")}catch(h){console.error("Error saving rankings:",h),je("Failed to save rankings","error")}finally{t(4,_=!1)}}}const Q=()=>window.location.reload(),z=h=>g(h),F=h=>j(h),W=h=>A(h);return r.$$.update=()=>{r.$$.dirty&2048&&t(6,s=k.params.id)},[c,b,m,o,_,d,s,g,j,A,Y,k,Q,z,F,W]}class lt extends Me{constructor(e){super(),Je(this,e,Xe,We,Te,{})}}export{lt as component};
