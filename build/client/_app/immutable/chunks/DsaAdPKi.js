import{d,w as s}from"./CRcJKmAs.js";import{s as m}from"./CCM_4jRA.js";import{l as f}from"./orW8a4RU.js";const u=s([]),g=s([]),y=s(!1),c=s(!1),i=s(null),l=s(null),p=d(u,e=>{const o={};return e.forEach(t=>{o[t.category_number]||(o[t.category_number]={number:t.category_number,name:t.category_name,subcategories:[]}),t.subcategory_letter&&o[t.category_number].subcategories.push({id:t.id,letter:t.subcategory_letter,name:t.subcategory_name,full_name:t.subcategory_name,description:t.description})}),o}),C=d(p,e=>Object.values(e).sort((o,t)=>parseInt(o.number)-parseInt(t.number))),B=d(g,e=>{const o=new Date;return e.filter(t=>t.active&&new Date(t.entry_deadline)>o).sort((t,n)=>new Date(t.entry_deadline)-new Date(n.entry_deadline))});d(g,e=>e.sort((o,t)=>{const n=r=>{if(!r)return new Date(0);try{let a=r;return r.includes(" ")&&!r.includes("T")&&(a=r.replace(" ","T"),!a.includes("+")&&!a.includes("Z")&&(a+="Z")),new Date(a)}catch{return new Date(0)}};return n(t.created_at)-n(o.created_at)}));async function w(e=!1){const o=new Date,t=f(l);if(!e&&t&&o-t<3e4){console.log("üéØ Using cached BJCP categories");return}c.set(!0),i.set(null);try{console.log("üìã Loading BJCP categories...");const{data:n,error:r}=await m.from("bjcp_categories").select("*").order("category_number",{ascending:!0}).order("subcategory_letter",{ascending:!0});if(r)throw console.error("‚ùå Error loading BJCP categories:",r),r;console.log(`‚úÖ Loaded ${(n==null?void 0:n.length)||0} BJCP categories`),u.set(n||[]),l.set(o)}catch(n){console.error("üí• Failed to load BJCP categories:",n),i.set(n.message||"Failed to load BJCP categories")}finally{c.set(!1),y.set(!0)}}async function b(e=!1){const o=new Date,t=f(l);if(!e&&t&&o-t<3e4){console.log("üèÜ Using cached competitions");return}c.set(!0),i.set(null);try{console.log("üèÜ Loading competitions...");const{data:n,error:r}=await m.from("competitions").select("*").order("entry_deadline",{ascending:!1});if(r)throw console.error("‚ùå Error loading competitions:",r),r;console.log(`‚úÖ Loaded ${(n==null?void 0:n.length)||0} competitions`),g.set(n||[]),l.set(o)}catch(n){console.error("üí• Failed to load competitions:",n),i.set(n.message||"Failed to load competitions")}finally{c.set(!1),y.set(!0)}}async function L(e=!1){console.log("üöÄ Loading all competition data...");try{await Promise.all([w(e),b(e)]),console.log("‚úÖ All competition data loaded successfully")}catch(o){throw console.error("üí• Failed to load competition data:",o),o}}function P(e){return f(u).find(t=>t.id===e)}function J(e){if(!e)return!1;const o=new Date,t=new Date(e.entry_deadline);return e.active&&t>o}function E(e){if(!e)return null;const o=new Date,n=new Date(e.entry_deadline)-o,r=Math.ceil(n/(1e3*60*60*24));return r>0?r:0}function T(e){if(!e)return"";const o=new Date(e.entry_deadline),t={weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"2-digit"};return o.toLocaleDateString("en-US",t)}typeof window<"u"&&(u.subscribe(e=>{console.log("üìã BJCP Categories updated:",e.length,"categories")}),g.subscribe(e=>{console.log("üèÜ Competitions updated:",e.length,"competitions")}),i.subscribe(e=>{e&&console.error("‚ùå Competition store error:",e)}));export{y as a,B as b,p as c,J as d,i as e,T as f,E as g,P as h,c as i,g as j,u as k,L as l,C as m,w as n};
